# トラブルシューティングガイド

## 🔧 よくあるエラーと解決方法

### エラー: 「未対応のファイル形式です」

**原因:** アップロードしたファイルの拡張子が対応していません。

**解決方法:**
- **動画ファイル**: `.mp4`, `.mov`, `.avi`, `.mkv` のいずれかを使用
- **データファイル**: `.csv`, `.xlsx`, `.xls` のいずれかを使用

### エラー: 「コメント列が見つかりません」

**原因:** コメントデータに必須の列がありません。

**解決方法:**
CSVまたはExcelファイルに以下のような列を含めてください：

```csv
minute,user,comment
0,user001,こんにちは!
1,user002,この商品いいですね
```

**自動認識される列名パターン:**
- コメント本文: `comment`, `コメント`, `message`, `text`, `本文`, `content`
- 時間: `time`, `minute`, `時間`, `分`, `timestamp`
- ユーザー名: `user`, `username`, `ユーザー`, `name`, `名前`

### エラー: 「配信データとコメントデータの両方が必要です」

**原因:** CSV/Excelファイルが2つ必要ですが、1つしかアップロードされていません。

**解決方法:**
- 配信データ（分チャート）: 視聴数、いいね、クリック等の時系列データ
- コメントデータ: タイムスタンプ付きコメント一覧

の2つのファイルを別々に準備してアップロードしてください。

### エラー: 「アップロードされたファイルが不完全です」

**原因:** 3つのファイルすべてがアップロードされていません。

**解決方法:**
以下の3つすべてをアップロードしてください：
1. 動画ファイル（MP4等）
2. 配信データ（分チャート）- CSV/Excel
3. コメントデータ - CSV/Excel

## 📁 ファイル命名のベストプラクティス

### ファイル名に含めると自動判別されやすいキーワード

**配信データファイル:**
- `data.csv`
- `配信データ.xlsx`
- `distribution_data.csv`
- `streaming_metrics.xlsx`

**コメントファイル:**
- `comments.csv`
- `コメント.xlsx`
- `chat.csv`
- `chat_log.xlsx`

### 推奨しないファイル名
- `file1.csv`, `file2.csv` (内容が不明)
- 日本語のみの複雑な名前
- 特殊文字を含む名前

## 📊 データフォーマットの例

### 配信データ（分チャート）の例

```csv
minute,viewers,likes,comments,clicks
0,100,5,3,1
1,150,12,8,2
2,200,25,15,5
3,180,30,20,8
4,220,45,28,12
```

**必須列:**
- `minute` または `time`: 時間（分単位）
- 任意の数値指標（viewers, likes, comments, clicks等）

### コメントデータの例

```csv
minute,user,comment
0,user001,こんにちは!楽しみ
1,user002,この商品気になります
1,user003,いくらですか?
2,user004,すごい!欲しい
2,user005,買います!
```

**必須列:**
- `minute` または `time`: コメント投稿時間
- `comment`: コメント本文

**オプション列:**
- `user`: ユーザー名

## 🔍 エラーログの確認方法

### ブラウザのコンソールでエラーを確認

1. ブラウザで `F12` キーを押す
2. 「Console」タブを開く
3. エラーメッセージを確認

**よくあるコンソールエラー:**

#### `Failed to load resource: 500`
サーバー側でエラーが発生しています。画面上のエラーメッセージを確認してください。

#### `Network Error`
サーバーに接続できません。以下を確認：
- サーバーが起動しているか
- URLが正しいか
- ネットワーク接続が有効か

## 💾 ファイルサイズの制限

### 動画ファイル
- **最大サイズ**: 500MB
- **推奨サイズ**: 100MB以下
- サイズが大きい場合は自動的に圧縮されますが、処理に時間がかかります

### データファイル（CSV/Excel）
- **制限**: 特になし
- **推奨**: 1万行以下

## 🌐 文字エンコーディングの問題

### CSVファイルの文字化け

システムは以下のエンコーディングを自動的に試行します：
1. UTF-8（BOM付き）
2. Shift-JIS
3. CP932（Windows日本語）

**推奨設定:**
- CSVを保存する際は **UTF-8（BOM付き）** を選択
- Excelで保存する場合は `.xlsx` 形式を推奨

### Excelで UTF-8 CSV を保存する方法
1. 「ファイル」→「名前を付けて保存」
2. ファイル形式で「CSV UTF-8（コンマ区切り）」を選択
3. 保存

## 🐛 デバッグモード

### 詳細なエラー情報を取得する

開発者向け: サーバーログを確認
```bash
cd /home/user/webapp
python app.py
```

コンソールに詳細なエラースタックトレースが表示されます。

## 📞 サポート

### エラーが解決しない場合

以下の情報を含めて報告してください：
1. エラーメッセージの全文
2. ブラウザのコンソールログ（F12キーで確認）
3. 使用したファイルの形式と列名
4. 実行環境（OS、ブラウザ）

## ✅ チェックリスト

分析を実行する前に確認：

- [ ] 動画ファイルが MP4/MOV/AVI/MKV 形式である
- [ ] 配信データ（CSV/Excel）に時間列がある
- [ ] 配信データに数値列（viewers, likes等）がある
- [ ] コメントデータ（CSV/Excel）にコメント列がある
- [ ] コメントデータに時間列がある
- [ ] 3つすべてのファイルを選択した
- [ ] ファイル名が判別しやすい

すべてチェックできたら「アップロード開始」をクリック！

---

## 🔄 よくある質問（FAQ）

### Q: 動画が大きすぎてアップロードできません
A: 事前に動画編集ソフトで圧縮するか、解像度を下げてください。推奨: 720p以下、100MB以下

### Q: データの列名が英語でも日本語でも動作しますか？
A: はい。両方自動認識します。

### Q: 3つのファイルがないと分析できませんか？
A: はい。動画、配信データ、コメントデータの3つすべてが必要です。

### Q: 分析にどれくらい時間がかかりますか？
A: 動画の長さによりますが、10分の動画で2-3分程度です。

### Q: 途中で中断されました
A: ブラウザを更新せず、そのまま待機してください。処理は続行されています。

---

**このガイドで解決しない場合は、GitHubのIssueまたはサポートにお問い合わせください。**
