# 対応データフォーマット詳細

## ✅ 確認済み対応フォーマット

このツールは以下の実際のデータフォーマットでテスト済みです。

### 1. 配信データ（分チャート）

#### サポートする列名パターン

| 項目 | 認識される列名例 |
|------|------------------|
| **時間（分）** | `経過時間 (分)`, `minute`, `時間`, `time`, `分`, `経過時間` |
| **視聴者数** | `同時視聴ユーザー数`, `viewers`, `視聴`, `同時視聴`, `concurrent`, `ユーザー数` |
| **いいね数** | `いいね数`, `likes`, `いいね`, `favorite`, `heart` |
| **コメント数** | `チャット数`, `comments`, `コメント数`, `chat`, `チャット` |
| **クリック数** | `商品クリック数`, `clicks`, `クリック数`, `商品`, `product` |

#### 実例 1: 日本語列名（テスト済み✅）

```csv
経過時間 (分),同時視聴ユーザー数,いいね数,シェア数,チャット数,商品クリック数,カート追加クリック数
1,19,25,0,0,0,0
2,18,5,0,1,0,0
3,26,5,0,2,0,0
```

**マッピング結果:**
- `経過時間 (分)` → `minute`
- `同時視聴ユーザー数` → `viewers`
- `いいね数` → `likes`
- `チャット数` → `comments`
- `商品クリック数` → `clicks`

#### 実例 2: 英語列名

```csv
minute,viewers,likes,comments,clicks
0,100,5,3,1
1,150,12,8,2
2,200,25,15,5
```

---

### 2. コメントデータ

#### サポートする列名パターン

| 項目 | 認識される列名例 |
|------|------------------|
| **コメント本文** | `original_text` (最優先), `text`, `コメント`, `comment`, `message`, `本文`, `content` |
| **時間** | `elapsed_time` (秒→分に自動変換), `minute`, `time`, `timestamp`, `経過時間` |
| **ユーザー名** | `username`, `user`, `ユーザー名`, `name`, `名前` |

#### 実例 1: SNS風フォーマット（テスト済み✅）

```csv
message_id,elapsed_time,user_type,guest_id,username,original_text,inserted_at,status
18ca24ce-...,2646.96,viewer,5d256488-...,DynamicCarrot,👋,2025-12-22 08:56:04,approved
b5a07915-...,2642.98,viewer,5c141a71-...,ModernCrisp,ぽっちゃり企画、期待してますあ,2025-12-22 08:55:46,approved
```

**マッピング結果:**
- `original_text` → `comment` (コメント本文)
- `elapsed_time` → 秒数を分に変換 → `minute`
- `username` → `user`

**注意:** `elapsed_time`が秒数の場合、自動的に60で割って分に変換します。

#### 実例 2: シンプルフォーマット

```csv
minute,user,comment
0,user001,こんにちは!
1,user002,この商品いいですね
2,user003,買います!
```

---

## 🔧 データ準備のベストプラクティス

### 配信データ（分チャート）

#### ✅ 推奨フォーマット

1. **時間列は必須**: 分単位の時間データを含める
2. **数値列を含める**: 少なくとも1つの数値指標（視聴者数、いいね等）
3. **列名は日本語・英語どちらでもOK**

#### ❌ 避けるべきフォーマット

- 時間列がない
- 全列が文字列（数値データがない）
- 列名が曖昧すぎる（例: `col1`, `data1`）

### コメントデータ

#### ✅ 推奨フォーマット

1. **コメント本文列は必須**: `original_text`, `comment`, `text` など
2. **時間情報を含める**: 分または秒単位
3. **空のコメントは避ける**

#### ❌ 避けるべきフォーマット

- コメント本文列がない
- すべてのコメントが空
- 時間情報がない（分析が不正確になる）

---

## 📊 よくある質問

### Q: 列名が認識されているか確認する方法は？

A: アップロード後、エラーメッセージで「利用可能な列: ...」と表示されます。そこに期待する列が含まれているか確認してください。

### Q: 追加の列があっても大丈夫？

A: はい。システムは必要な列のみを抽出します。`シェア数`, `カート追加クリック数` などの追加列は無視されます。

### Q: elapsed_timeが秒数の場合は？

A: 自動的に分に変換されます（60で割る）。例: `2646.96秒` → `44分`

### Q: 列名に特殊文字（括弧、スペース等）が含まれていても大丈夫？

A: はい。`経過時間 (分)` のような列名も正しく認識されます。

### Q: Excelファイルでも大丈夫？

A: はい。`.xlsx`, `.xls` 形式に対応しています。

---

## 🧪 動作確認済みプラットフォーム

以下のプラットフォームからエクスポートされたデータで動作確認済み:

- ✅ カスタムSNSプラットフォーム（elapsed_time形式）
- ✅ 日本語列名の分チャート
- ✅ 英語列名のシンプルフォーマット

---

## 🛠 トラブルシューティング

### エラー: 「コメント列が見つかりません」

**原因:** コメント本文を含む列が認識されていません。

**解決方法:**
1. 列名を確認: `text`, `comment`, `original_text` などの文字列を含んでいるか
2. 列名を変更: より認識しやすい名前に（例: `本文` → `comment`）

### エラー: 「配信データとコメントデータの両方が必要です」

**原因:** 2つのCSV/Excelファイルが必要ですが、1つしかアップロードされていません。

**解決方法:**
- 配信データ（分チャート）
- コメントデータ
の2つを別々にアップロードしてください。

---

## 📝 データ変換スクリプト例

もし現在のデータが対応していない場合、以下のPythonスクリプトで変換できます:

```python
import pandas as pd

# 既存のデータを読み込み
df = pd.read_csv('your_data.csv')

# 列名を変更
df = df.rename(columns={
    '旧列名1': 'minute',
    '旧列名2': 'viewers',
    '旧列名3': 'comment'
})

# 保存
df.to_csv('converted_data.csv', index=False, encoding='utf-8-sig')
```

---

**最終更新**: 2026-01-18  
**テスト済みデータ**: 実ユーザーデータで動作確認済み ✅
